From 4d2dd6d67282bad98dcf0384caf1d3d5e8632d47 Mon Sep 17 00:00:00 2001
From: Nathan Barrett Morrison <nathan.morrison@timesys.com>
Date: Tue, 7 May 2019 12:45:13 -0400
Subject: [PATCH] Change u-boot environment to use zImage (Yocto's default)
 instead of uImage

---
 include/configs/sc_adi_common.h | 26 +++++++++++++++++---------
 1 file changed, 17 insertions(+), 9 deletions(-)

diff --git a/include/configs/sc_adi_common.h b/include/configs/sc_adi_common.h
index da3599c1a..b239c487b 100644
--- a/include/configs/sc_adi_common.h
+++ b/include/configs/sc_adi_common.h
@@ -114,7 +114,17 @@
 	"earlyprintk=serial,uart0,57600 " \
 	"console=ttySC" __stringify(CONFIG_UART_CONSOLE) "," \
 			__stringify(CONFIG_BAUDRATE) " "\
-		"mem=" CONFIG_LINUX_MEMSIZE
+	"mem=" CONFIG_LINUX_MEMSIZE
+
+#define CONFIG_BOOTARGS_NFS	\
+	"root=/dev/nfs rw " \
+	"nfsroot=${serverip}:${rootpath},tcp,nfsvers=3 " \
+	"clkin_hz=" __stringify(CONFIG_CLKIN_HZ) " " \
+	CONFIG_BOOTARGS_VIDEO \
+	"earlyprintk=serial,uart0,57600 " \
+	"console=ttySC" __stringify(CONFIG_UART_CONSOLE) "," \
+			__stringify(CONFIG_BAUDRATE) " "\
+	"mem=" CONFIG_LINUX_MEMSIZE
 
 #if defined(CONFIG_CMD_NET)
 # define UBOOT_ENV_FILE "u-boot.ldr"
@@ -154,7 +164,7 @@
 		   "${hostname}:eth0:off" \
 		"\0" \
 	\
-	"ramfile=uImage\0" \
+	"ramfile=zImage\0" \
 	"dtbfile=" CONFIG_DTBNAME "\0" \
 	"dtbaddr=" CONFIG_DTBLOADADDR "\0" \
 	"ramargs=set bootargs " CONFIG_BOOTARGS "\0" \
@@ -163,19 +173,17 @@
 		"tftp ${dtbaddr} ${dtbfile};" \
 		"run ramargs;" \
 		"run addip;" \
-		"bootm ${loadaddr} - ${dtbaddr}" \
+		"bootz ${loadaddr} - ${dtbaddr}" \
 		"\0" \
 	\
-	"nfsfile=vmImage\0" \
-	"nfsargs=set bootargs " \
-		"root=/dev/nfs rw " \
-		"nfsroot=${serverip}:${rootpath},tcp,nfsvers=3" \
-		"\0" \
+	"nfsfile=zImage\0" \
+	"nfsargs=set bootargs " CONFIG_BOOTARGS_NFS "\0" \
 	"nfsboot=" \
 		"tftp ${loadaddr} ${nfsfile};" \
+		"tftp ${dtbaddr} ${dtbfile};" \
 		"run nfsargs;" \
 		"run addip;" \
-		"bootm" \
+		"bootz ${loadaddr} - ${dtbaddr}" \
 		"\0"
 #else
 # define NETWORK_ENV_SETTINGS
-- 
2.11.0

